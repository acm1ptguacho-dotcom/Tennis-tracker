
:root{
  --bg0:#0f172a;
  --bg1:#111c33;
  --card:#182544;
  --card2:#1b2a4c;
  --stroke:rgba(255,255,255,.10);
  --stroke2:rgba(255,255,255,.16);
  --text:#eaf0ff;
  --muted:rgba(234,240,255,.70);
  --accent:#4da3ff;
  --good:#2ecc71;
  --warn:#ff8a00;
  --bad:#ff4d4d;

  --yellow:#ffff00;
  --red:#ff0000;

  --radius:18px;
  --shadow: 0 18px 50px rgba(0,0,0,.28);
  --shadow2: 0 10px 26px rgba(0,0,0,.22);
  --inset: inset 0 1px 0 rgba(255,255,255,.10);
  --blur: blur(10px);
  --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
}

html,body{height:100%; overflow-y:auto; overflow-x:hidden;}
body{
  padding-bottom: 64px;
  margin:0;
  font-family:var(--font);
  color:var(--text);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(77,163,255,.16), transparent 55%),
    radial-gradient(900px 600px at 80% 30%, rgba(46,204,113,.10), transparent 55%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}

body.light{
  --bg0:#e8eefc;
  --bg1:#cfe0ff;
  --card:rgba(255,255,255,.75);
  --card2:rgba(255,255,255,.62);
  --stroke:rgba(10,22,55,.14);
  --stroke2:rgba(10,22,55,.22);
  --text:#0b1430;
  --muted:rgba(11,20,48,.65);
  --shadow: 0 16px 40px rgba(10,22,55,.18);
  --shadow2: 0 10px 24px rgba(10,22,55,.14);
  background:
    radial-gradient(1200px 700px at 20% 10%, rgba(77,163,255,.22), transparent 60%),
    radial-gradient(900px 600px at 80% 30%, rgba(46,204,113,.14), transparent 60%),
    linear-gradient(180deg, var(--bg0), var(--bg1));
}

a{color:inherit}
*{box-sizing:border-box;}

.app{
  max-width: 980px;
  margin: 0 auto;
  display:flex;
  flex-direction:column;
  gap:10px;
  padding: 12px;
  min-height: 100vh;
  box-sizing:border-box;
}

.topbar{
  position: sticky;
  top: 0;
  z-index: 30;
display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.brand{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius: 999px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
  border: 1px solid var(--stroke);
  box-shadow: var(--inset);
  backdrop-filter: var(--blur);
}
.logoDot{width:10px;height:10px;border-radius:50%;
  background: radial-gradient(circle at 30% 30%, #fff, rgba(255,255,255,.15));
  box-shadow: 0 0 0 3px rgba(77,163,255,.18), 0 0 20px rgba(77,163,255,.22);
}
.brand b{letter-spacing:.4px}
.brand small{opacity:.7}

.chips{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;}
.chip, .btn{
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  color:var(--text);
  border-radius: 999px;
  padding:10px 14px;
  font-weight:800;
  letter-spacing:.3px;
  cursor:pointer;
  box-shadow: var(--inset), 0 8px 18px rgba(0,0,0,.14);
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background .12s ease, opacity .12s ease;
}
.chip:hover,.btn:hover{transform: translateY(-1px); border-color: var(--stroke2); box-shadow: var(--inset), 0 12px 26px rgba(0,0,0,.18);}
.chip:active,.btn:active{transform: translateY(0px) scale(.98); box-shadow: var(--inset), 0 6px 14px rgba(0,0,0,.16);}
.chip.primary{border-color: rgba(77,163,255,.35); background: linear-gradient(180deg, rgba(77,163,255,.28), rgba(77,163,255,.12));}
.chip.warn{border-color: rgba(255,138,0,.35); background: linear-gradient(180deg, rgba(255,138,0,.22), rgba(255,138,0,.10));}
.chip.good{border-color: rgba(46,204,113,.35); background: linear-gradient(180deg, rgba(46,204,113,.22), rgba(46,204,113,.10));}
.chip.bad{border-color: rgba(255,77,77,.35); background: linear-gradient(180deg, rgba(255,77,77,.22), rgba(255,77,77,.10));}
.chip.ghost{opacity:.85}
.chip:disabled,.btn:disabled{opacity:.45; cursor:not-allowed; transform:none;}
.pillToggle{display:flex; gap:8px; align-items:center; padding:10px 12px;}

.mainLeft, .mainRight{
  border-radius: var(--radius);
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  box-shadow: var(--shadow);
  backdrop-filter: var(--blur);
}
.mainLeft{overflow:visible;}
.mainRight{overflow:visible;}
.mainLeft{display:flex; flex-direction:column;}
.mainRight{display:flex; flex-direction:column; gap:12px; padding:14px;}

.section{
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
  box-shadow: var(--shadow2), var(--inset);
  padding:12px;
}

.row{display:flex; gap:12px; flex-wrap:wrap; align-items:stretch;}
.playerCard{
  flex:1;
  min-width: 180px;
  display:flex; flex-direction:column; gap:4px;
}
.playerCard label{font-size:12px; opacity:.7; font-weight:900; letter-spacing:.4px;}
.playerCard input{
  border:1px solid var(--stroke);
  border-radius: 14px;
  padding:10px 12px;
  font-weight:900;
  background: rgba(0,0,0,.14);
  color: var(--text);
  outline:none;
}
body.light .playerCard input{background: rgba(255,255,255,.70);}
.kpis{display:flex; gap:10px; margin-top:10px;}
.kpi{
  flex:1;
  border:1px solid var(--stroke);
  border-radius: 16px;
  padding:10px;
  text-align:center;
  background: linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.02));
}
body.light .kpi{background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.62));}
.kpi .t{font-size:12px; opacity:.7; font-weight:900;}
.kpi .v{font-size:20px; font-weight:1000; margin-top:4px;}

.statusBar{
  display:flex; gap:10px; align-items:center; flex-wrap:wrap;
  padding:12px 14px;
  border-top:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(0,0,0,.12), rgba(0,0,0,.02));
}
body.light .statusBar{background: linear-gradient(180deg, rgba(255,255,255,.80), rgba(255,255,255,.62));}
.statusBadge{
  display:inline-flex; gap:8px; align-items:center;
  padding:8px 12px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.14);
  font-weight:1000;
}
body.light .statusBadge{background: rgba(255,255,255,.70);}
.muted{color:var(--muted); font-weight:800;}
.mono{font-family: ui-monospace, Menlo, Consolas, monospace;}

.courtWrap{
  position:relative;
  width:100%;
  flex:1;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:16px;
  background:
    radial-gradient(800px 500px at 40% 20%, rgba(77,163,255,.10), transparent 60%),
    linear-gradient(180deg, rgba(0,0,0,.10), rgba(0,0,0,.02));
}
body.light .courtWrap{
  background:
    radial-gradient(800px 500px at 40% 20%, rgba(77,163,255,.18), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.62), rgba(255,255,255,.40));
}
.court{
  position:relative;
  width:min(760px, 98%);
  aspect-ratio: 9 / 18;
  border-radius: 22px;
  box-shadow: 0 30px 70px rgba(0,0,0,.28);
  overflow:hidden;
  border:1px solid rgba(255,255,255,.10);
}
body.light .court{border:1px solid rgba(10,22,55,.18);}


.courtSurface{
  position:absolute;
  inset:0;
  transform-origin: 50% 50%;
  transition: transform 260ms cubic-bezier(.2,.9,.2,1);
}
.court.rotated .courtSurface{
  transform: rotate(180deg);
}

/* keep labels upright when rotated */
.court.rotated .zoneTxt{
  display:inline-block;
  transform: rotate(180deg);
}
.court.rotated .baselineName{
  transform: rotate(180deg);
  transform-origin: 50% 50%;
}
.court.rotated .arrowNumText{
  transform-box: fill-box;
  transform-origin: center;
  transform: rotate(180deg);
}

.baselineName{
  position:absolute;
  left:0; right:0;
  text-align:center;
  color: rgba(255,255,255,.96);
  font-weight: 1000;
  letter-spacing: .08em;
  text-transform: uppercase;
  text-shadow: 0 4px 16px rgba(0,0,0,.40);
  pointer-events:none;
  z-index: 2;
  font-size: 13px;
}
.baselineTop{ top: 18px; }
.baselineBottom{ bottom: 18px; }
.court img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  filter:saturate(1.05) contrast(1.02);
}

.zoneLayer{position:absolute; inset:0; pointer-events:auto; z-index:4;}

.gridLayer{position:absolute;inset:0;pointer-events:auto;}
.zoneCell,.serveCell{touch-action:manipulation;}
.zoneGrid{
  position:absolute;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(3, 1fr);
  gap: 0px;
  pointer-events:none;
}
.zoneCell, .serveCell{
  pointer-events:auto;
  display:flex;
  align-items:flex-start;
  justify-content:center;
  color: rgba(255,255,255,.88);
  font-weight:1000;
  border-radius: 10px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.10);
  user-select:none;
  cursor:pointer;
  transition: transform .08s ease, background .12s ease, border-color .12s ease;
}
body.light .zoneCell, body.light .serveCell{
  color: rgba(10,22,55,.88);
  background: rgba(255,255,255,.22);
  border:1px solid rgba(10,22,55,.12);
}
.zoneCell:hover, .serveCell:hover{transform: translateY(-1px); background: rgba(255,255,255,.10);}
body.light .zoneCell:hover, body.light .serveCell:hover{background: rgba(255,255,255,.38);}

.zoneLabel{position:absolute; top:10px; left:10px; padding:6px 10px; border-radius:999px; border:1px solid var(--stroke); background: rgba(0,0,0,.18); font-weight:1000;}
body.light .zoneLabel{background: rgba(255,255,255,.70);}

.hidden{display:none !important;}

.timeline{
  display:flex; gap:8px; overflow:auto;
  padding:10px;
  border:1px solid var(--stroke);
  border-radius: 16px;
  background: rgba(0,0,0,.10);
}
body.light .timeline{background: rgba(255,255,255,.62);}
.tok{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 10px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
  font-weight:1000;
  white-space:nowrap;
}
.tok small{opacity:.7; font-weight:900}
.tok.a{border-color: rgba(46,204,113,.35); }
.tok.b{border-color: rgba(255,138,0,.35); }
.tok.active{outline:3px solid rgba(77,163,255,.28);}

.seqList{
  border:1px solid var(--stroke);
  border-radius: 16px;
  overflow:auto;
  max-height: 30vh;
}
.seqItem{
  padding:10px 12px;
  border-bottom:1px solid var(--stroke);
  display:flex; gap:10px; align-items:flex-start;
}
.seqItem:last-child{border-bottom:none}
.seqItem .n{font-weight:1000; opacity:.75; width:34px;}
.seqItem .t{font-weight:1000}
.seqItem .t .a{color: rgba(46,204,113,.95)}
.seqItem .t .b{color: rgba(255,138,0,.95)}

.gridBtns{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
.btnBig{
  border-radius: 16px;
  padding:14px 12px;
  font-size:14px;
}
.btn.primary{border-color: rgba(77,163,255,.35); background: linear-gradient(180deg, rgba(77,163,255,.28), rgba(77,163,255,.12));}
.btn.good{border-color: rgba(46,204,113,.35); background: linear-gradient(180deg, rgba(46,204,113,.22), rgba(46,204,113,.10));}
.btn.warn{border-color: rgba(255,138,0,.35); background: linear-gradient(180deg, rgba(255,138,0,.22), rgba(255,138,0,.10));}
.btn.bad{border-color: rgba(255,77,77,.35); background: linear-gradient(180deg, rgba(255,77,77,.22), rgba(255,77,77,.10));}
.btn.soft{opacity:.9}

.modal{
  position:fixed; inset:0; z-index:1000;
  background: rgba(0,0,0,.45);
  backdrop-filter: blur(10px);
  display:flex;
  align-items:flex-start;
  justify-content:center;
  padding:18px;
}
.modalCard{
  width:min(1100px, 96vw);
  max-height: 88vh;
  border-radius: 22px;
  border:1px solid var(--stroke);
  background: rgba(14, 20, 32, 0.98);
  box-shadow: var(--shadow);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

body.light .modalCard{background: rgba(14, 20, 32, 0.98);}
.modalHeader{
  display:flex; align-items:flex-start; justify-content:space-between; gap:12px;
  padding:14px 16px;
  border-bottom:1px solid var(--stroke);
}
/* Compatibilidad: algunos modales usan .modalHead */
.modalHead{
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:12px;
  padding:14px 16px;
  border-bottom:1px solid var(--stroke);
}
.modalActions{ display:flex; gap:10px; align-items:center; justify-content:flex-end; flex-wrap:wrap; }
.modalTitle{font-size:16px; font-weight:1100}
.modalSub{font-size:12px; opacity:.75; font-weight:900}
.modalBody{padding:14px 16px; overflow:auto; max-height: 78vh;}

.table{
  width:100%;
  border-collapse: collapse;
  font-size:12px;
}
.table th,.table td{
  border-bottom:1px solid var(--stroke);
  padding:10px 10px;
  text-align:left;
  vertical-align:top;
}
.table th{
  position:sticky; top:0;
  background: rgba(0,0,0,.18);
  z-index:1;
}
body.light .table th{background: rgba(255,255,255,.78);}

.filters{
  display:flex; gap:10px; flex-wrap:wrap; align-items:center;
  padding:10px; border:1px solid var(--stroke); border-radius:16px;
  background: rgba(0,0,0,.10);
}
body.light .filters{background: rgba(255,255,255,.62);}
.filters label{font-size:12px; font-weight:1000; opacity:.8}
.filters select,.filters input{
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.12);
  color:var(--text);
  padding:8px 10px;
  border-radius: 12px;
  font-weight:900;
  outline:none;
}
body.light .filters select, body.light .filters input{background: rgba(255,255,255,.72);}

.toast{
  position:fixed; left:50%; bottom:22px; transform: translateX(-50%);
  padding:10px 14px;
  border-radius:999px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.28);
  color: var(--text);
  font-weight:1000;
  box-shadow: var(--shadow2);
  opacity:0;
  pointer-events:none;
  transition: opacity .15s ease, transform .15s ease;
  z-index:2000;
}
.toast.show{opacity:1; transform: translateX(-50%) translateY(-4px);}

/* Coach mode: bigger controls + hide non-essentials */
body.coach .app{grid-template-columns: 1fr 360px;}
body.coach .btnBig{padding:18px 14px; font-size:16px;}
body.coach .tok{padding:10px 12px; font-size:14px;}
body.coach .seqList{max-height: 36vh;}
body.coach .muted.smallHide{display:none;}
body.coach .kpi .t{font-size:13px}
body.coach .kpi .v{font-size:24px}

/* Tap highlight vivid yellow + red outline (matches sample) */
.zoneCell, .serveCell{position:relative; overflow:hidden; transform: translateZ(0);}
.zoneCell::before, .serveCell::before{
  content:""; position:absolute; inset:0; pointer-events:none; opacity:0; z-index:1;
  background: rgba(255,255,0,.92);
  border:8px solid rgba(255,0,0,.99);
  border-radius: 8px;
  box-sizing:border-box;
  box-shadow: 0 0 28px rgba(255,255,0,.55), 0 0 18px rgba(255,0,0,.35), 0 0 60px rgba(255,255,0,.22);
  transition: opacity 140ms ease;
}
.zoneCell.tapHold::before, .serveCell.tapHold::before{opacity:1;}
.zoneCell::after, .serveCell::after{
  content:""; position:absolute; inset:0; pointer-events:none; opacity:0; z-index:2;
  background: rgba(255,255,0,1);
  border-radius:8px;
  clip-path: circle(0% at var(--tap-x,50%) var(--tap-y,50%));
  filter: drop-shadow(0 0 22px rgba(255,255,0,.85)) drop-shadow(0 0 10px rgba(255,0,0,.40));
}
.zoneCell.tapFlash::after, .serveCell.tapFlash::after{animation: tapFillPro 520ms cubic-bezier(.12,.92,.18,1) forwards;}
.zoneCell.tapFlash, .serveCell.tapFlash{
  animation: tapPopPro 520ms cubic-bezier(.14,.88,.2,1) forwards;
  box-shadow: 0 0 0 10px rgba(255,0,0,.98) inset, 0 0 70px rgba(255,255,0,.35), 0 0 30px rgba(255,0,0,.25), 0 0 14px rgba(255,255,255,.10);
}
@keyframes tapFillPro{
  0%{opacity:1; clip-path: circle(0% at var(--tap-x,50%) var(--tap-y,50%));}
  55%{opacity:1; clip-path: circle(160% at var(--tap-x,50%) var(--tap-y,50%));}
  100%{opacity:0; clip-path: circle(190% at var(--tap-x,50%) var(--tap-y,50%));}
}
@keyframes tapPopPro{
  0%{transform: translateZ(0) scale(1);}
  20%{transform: translateZ(0) scale(1.05);}
  60%{transform: translateZ(0) scale(1.02);}
  100%{transform: translateZ(0) scale(1);}
}


.mainLeft{grid-column:1 / 2; grid-row:1 / 2;}
.mainRight{grid-column:2 / 3; grid-row:1 / 2;}

.diagramOnly{padding:10px;}
#scoreSection .row{margin-bottom:10px;}

.mainRight .section{margin-bottom:14px;}
.zoneCell.disabled, .serveCell.disabled{
  pointer-events:none !important;
  opacity: 0.08;
  filter: saturate(0.6);
}
.zoneCell.hidden, .serveCell.hidden{
  pointer-events:none !important;
  opacity: 0 !important;
}
.legendGrid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap:10px 12px;
  margin-top:10px;
}
.legendItem{
  display:flex; align-items:center; gap:10px;
  padding:10px 12px;
  border-radius: 14px;
  border:1px solid var(--stroke);
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
}
.legendItem b{
  min-width:72px;
  display:inline-flex;
  justify-content:center;
  padding:6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.14);
}
.legendMore{
  margin-top:10px;
  border:1px solid var(--stroke);
  border-radius: 14px;
  padding:10px 12px;
  background: rgba(0,0,0,.08);
}
.legendMore summary{cursor:pointer;}
.legendExamples{margin-top:10px; display:grid; gap:6px;}

/* Scorebar: keep names+score always visible */
.scorebar{
  position: sticky;
  top: 64px;
  z-index: 20;
  padding: 10px 14px 0;
}
@media (max-width: 820px){
  .scorebar{ top: 58px; padding: 8px 10px 0; }
}

/* Floating tennis ball menu */
.tennisBall{
  position: absolute;
  right: 12px;
  top: 12px;
  width: 64px;
  height: 64px;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  z-index: 60;

  /* realistic-ish ball: neon yellow with subtle shading */
  background:
    radial-gradient(120% 120% at 30% 30%,
      rgba(255,255,255,.55) 0%,
      rgba(255,255,255,.12) 20%,
      rgba(255,255,0,1) 42%,
      rgba(225,210,0,1) 70%,
      rgba(170,150,0,1) 100%);
  box-shadow:
    0 14px 26px rgba(0,0,0,.35),
    0 0 0 2px rgba(255,255,255,.15) inset;
  transition: transform .18s ease, box-shadow .18s ease, filter .18s ease;
}
.tennisBall::before,
.tennisBall::after{
  content:"";
  position:absolute;
  inset: 10px;
  border-radius: 999px;
  border: 3px solid rgba(255,255,255,.70);
  opacity: .65;
  filter: blur(.1px);
}
.tennisBall::before{
  clip-path: polygon(0 0, 55% 0, 45% 100%, 0 100%);
  transform: rotate(18deg);
}
.tennisBall::after{
  clip-path: polygon(45% 0, 100% 0, 100% 100%, 55% 100%);
  transform: rotate(18deg);
}
.tennisBall:hover{ transform: translateY(-2px) scale(1.02); }
.tennisBall:active{ transform: translateY(0px) scale(.98); }

.finishMenu{
  position: fixed;
  right: 16px;
  top: auto;
  bottom: calc(env(safe-area-inset-bottom, 0px) + 88px);
  z-index: 65;
}
.finishMenu.hidden{ display:none; }

.finishMenuCard{
  width: min(360px, calc(100vw - 28px));
  border-radius: 18px;
  background: rgba(18, 26, 40, 0.98);
  border: 1px solid rgba(255,255,255,.10);
  box-shadow: 0 22px 48px rgba(0,0,0,.45);
  padding: 14px;
  transform-origin: 90% 0%;
  animation: finishOpen .28s cubic-bezier(.18,.9,.22,1) both;
}
@keyframes finishOpen{
  0%{ opacity:0; transform: translateY(-8px) scale(.92); }
  70%{ opacity:1; transform: translateY(0) scale(1.02); }
  100%{ opacity:1; transform: translateY(0) scale(1); }
}
.finishMenuClose{
  position:absolute;
  right: 10px;
  top: 8px;
  width: 34px;
  height: 34px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color: rgba(255,255,255,.92);
  font-size: 20px;
  line-height: 30px;
  cursor:pointer;
}
.finishMenuTitle{ font-weight: 900; font-size: 16px; }
.finishMenuSub{ color: rgba(255,255,255,.68); font-size: 12px; margin-top: 2px; margin-bottom: 12px; }

.finishMenuGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.finishBtn{
  padding: 12px 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.06);
  color: white;
  font-weight: 800;
  cursor: pointer;
  transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
}
.finishBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
.finishBtn:active{ transform: translateY(0); }

.finishBtn.bad{
  background: linear-gradient(180deg, rgba(255,46,46,.82), rgba(160,0,0,.65));
  border-color: rgba(255,46,46,.95);
  box-shadow: 0 0 0 1px rgba(255,46,46,.55) inset, 0 10px 30px rgba(255,46,46,.22), 0 10px 24px rgba(0,0,0,.25);
}
.finishBtn.warn{
  background: linear-gradient(180deg, rgba(255,199,0,.84), rgba(160,104,0,.62));
  border-color: rgba(255,199,0,.92);
  box-shadow: 0 0 0 1px rgba(255,199,0,.45) inset, 0 10px 30px rgba(255,199,0,.16), 0 10px 24px rgba(0,0,0,.25);
}
.finishBtn:active{ transform: translateY(1px); }
.finishBtn.good{
  background: linear-gradient(180deg, rgba(53,240,138,.78), rgba(0,135,76,.62));
  border-color: rgba(53,240,138,.92);
  box-shadow: 0 0 0 1px rgba(53,240,138,.45) inset, 0 10px 30px rgba(53,240,138,.18), 0 10px 24px rgba(0,0,0,.25);
}

@media (max-width: 820px){
  .tennisBall{
    width: 58px;
    height: 58px;
    top: calc(env(safe-area-inset-top, 0px) + 70px);
  }
  .finishMenu{ top: calc(env(safe-area-inset-top, 0px) + 140px); }
}

/* History: two columns (list + detail) with independent scroll */
.historyGrid{
  display:flex;
  gap: 12px;
  margin-top: 12px;
  flex: 1;
  min-height: 0;
}

/* History (Option 1): lista de una columna dentro del modal */
.historyHint{
  margin-top: 10px;
  font-size: 12px;
}
.historyListFull{
  margin-top: 10px;
  flex: 1;
  min-height: 0;
  overflow: auto;
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  background: rgba(0,0,0,.12);
}

.historyCol{
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  background: rgba(0,0,0,.12);
  overflow: hidden;
  height: 100%;
  display:flex;
  flex-direction:column;
  min-height:0;
}

.historyListCol{ width: 46%; }
.historyDetailCol{ flex: 1; }
.historyList{
  flex:1;
  min-height:0;
  overflow:auto;
}

.historyDetail{
  flex:1;
  min-height:0;
  overflow:auto;
  padding: 12px;
  color: rgba(255,255,255,.92);
}

.historyItem{
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,.08);
  cursor:pointer;
}
.historyItem:hover{ background: rgba(255,255,255,.06); }
.historyItem.active{ background: rgba(255,255,255,.10); }
.historyItemTop{
  display:flex;
  justify-content:space-between;
  gap: 10px;
  align-items:flex-start;
}
.historyItemTitle{ font-weight: 900; }
.historyItemMeta{ color: rgba(255,255,255,.70); font-size: 12px; margin-top: 4px; }
@media (max-width: 820px){
  .historyGrid{ height: 60vh; }
  .historyListCol{ width: 48%; }
}

/* Visor de punto (pantalla completa) */
.modalCard.pointCard{
  width: min(1100px, 98vw);
  height: min(94vh, 980px);
  max-height: 94vh;
}
.pointViewerBody{
  padding: 12px 14px;
  display:flex;
  flex-direction:column;
  gap: 12px;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}
.pointViewerTools{
  display:flex;
  justify-content:flex-end;
  gap: 10px;
  flex-wrap: wrap;
}
.pointViewerCourtWrap{
  flex: 1;
  min-height: 0;
  display:flex;
  align-items:center;
  justify-content:center;
  padding: 6px;
}
.pointViewerCourt{
  position: relative;
  height: 100%;
  max-height: 100%;
  aspect-ratio: 9 / 18;
  width: auto;
  max-width: min(760px, 100%);
  border-radius: 22px;
  overflow: hidden;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.14);
  box-shadow: 0 20px 60px rgba(0,0,0,.22);
}
.pointViewerCourt img{
  width: 100%;
  height: 100%;
  object-fit: cover;
  display:block;
}
.pointViewerDetails{
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  padding: 10px 12px;
  background: rgba(0,0,0,.10);
}
.pointViewerDetails summary{
  cursor:pointer;
  font-weight: 1000;
}
.pointViewerEvents{
  margin-top: 8px;
}

@media (max-width: 820px){
  .modalCard.pointCard{
    width: 100vw;
    height: 100dvh;
    max-height: none;
    border-radius: 0;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .pointViewerBody{
    padding-bottom: calc(env(safe-area-inset-bottom) + 12px);
  }
}

/* Layout mobile order */
@media (max-width: 820px){
  .app{ grid-template-columns: 1fr; }
  .mainRight{ grid-column:1 / 2; grid-row:1 / 2; }
  .mainLeft{ grid-column:1 / 2; grid-row:2 / 3; }
  .topbar{ position: sticky; top: 0; z-index: 35; }
  .scorebar{ top: 58px; }
  /* reduce header height a bit */
  .chips{ gap:8px; flex-wrap: nowrap; overflow-x:auto; padding-bottom: 4px; }
}


/* ---- Layout refinements (v2.27) ---- */
.mainRight.actionCol{ padding:14px; gap:12px; }
.topbarLeft{ padding:10px 12px; }
.topbar .brand{ display:none; } /* remove logo/nota */

.scoreCompact{ padding:10px 12px; }
.scoreCompact .scoreNames{ margin-bottom:8px; gap:10px; }
.playerCard.compact label{ font-size:12px; opacity:.85; }
.playerCard.compact input{
  height: 38px;
  font-size: 14px;
  padding: 8px 10px;
  border-radius: 14px;
}
.kpisCompact{
  margin-top: 8px;
  gap: 8px;
}
.kpisCompact .kpi{
  padding: 8px 8px;
  min-width: 54px;
}
.kpisCompact .kpi .t{ font-size: 11px; opacity:.85; }
.kpisCompact .kpi .v{ font-size: 18px; }

.stateCompact{
  margin-top: 8px;
  gap: 8px;
  flex-wrap: wrap;
}
.stateCompact .badge{
  padding: 6px 10px;
  font-size: 12px;
}

/* Put action tennis ball inside the diagram corner (as requested) */
.tennisBall.inCourt{
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 25;
  width: 58px;
  height: 58px;
}

/* v2.44: FAB estilo broadcast (✓) en la esquina inferior derecha del diagrama */
.tennisBall.inCourt.fab{
  top: auto;
  bottom: 16px;
  right: 16px;
  width: 56px;
  height: 56px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.12);
  box-shadow: 0 14px 30px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.12);
  backdrop-filter: var(--blur);
  display:grid;
  place-items:center;
  font-size: 24px;
  font-weight: 1100;
  color: rgba(255,255,255,.96);
}
.tennisBall.inCourt.fab::before,
.tennisBall.inCourt.fab::after{
  display:none;
}

/* Ensure diagram column uses space better */
.mainLeft{ padding:14px; display:flex; flex-direction:column; gap:12px; }
.diagramOnly{ padding:10px; }
.courtWrap{ display:flex; justify-content:center; align-items:flex-start; padding-top:4px; }
.zoneLabel{ top: 12px; left: 12px; }

/* Mobile: stack columns, keep menu+score+court visible */
@media (max-width: 900px){
  .app{ grid-template-columns: 1fr; }
  .mainRight.actionCol{ order: 2; }
  .mainLeft{ order: 1; }
  .topbar{ position: sticky; top: 0; z-index: 30; }
}


/* --- Mobile-first single layout --- */
.topbarInline{
  position: sticky;
  top: 0;
  z-index: 40;
  padding-top: env(safe-area-inset-top);
}

/* Menú hamburguesa */
.topbarRow{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  padding: 8px 2px 10px;
}
.topbarRight{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  justify-content:flex-end;
}
.iconChip{
  width: 44px;
  padding: 10px 0;
  display:grid;
  place-items:center;
  font-size: 18px;
}

/* Drawer */
.menuOverlay{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.45);
  backdrop-filter: blur(5px);
  opacity: 0;
  pointer-events: none;
  transition: opacity .18s ease;
  z-index: 60;
}
.menuOverlay.open{
  opacity: 1;
  pointer-events: auto;
}

.drawer{
  position: fixed;
  left: 12px;
  top: calc(env(safe-area-inset-top, 0px) + 12px);
  width: min(340px, 88vw);
  max-height: calc(100vh - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px) - 24px);
  overflow:auto;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(16,26,40,.98), rgba(10,16,26,.98));
  box-shadow: 0 22px 60px rgba(0,0,0,.55);
  transform: translateX(-120%);
  opacity: 0;
  pointer-events: none;
  transition: transform .22s cubic-bezier(.2,.9,.2,1), opacity .18s ease;
  z-index: 61;
  padding: 12px;
}
body.light .drawer{
  background: linear-gradient(180deg, rgba(255,255,255,.96), rgba(245,246,250,.96));
  border: 1px solid rgba(10,22,55,.18);
}

.drawer.open{
  transform: translateX(0);
  opacity: 1;
  pointer-events: auto;
}
.drawerHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom: 10px;
}
.drawerTitle{
  font-weight: 1100;
  letter-spacing: .02em;
}
.drawerBody{
  display:flex;
  flex-direction:column;
  gap:10px;
}
.drawerDivider{
  height:1px;
  background: rgba(255,255,255,.10);
  margin: 6px 2px;
}
body.light .drawerDivider{ background: rgba(10,22,55,.12); }


.chipsScroll{
  overflow-x:auto;
  overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  white-space:nowrap;
  padding: 8px 2px 10px;
}
.chipsScroll::-webkit-scrollbar{ display:none; }

.scoreMini{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.04));
  border: 1px solid var(--stroke);
  border-radius: var(--radius);
  box-shadow: var(--shadow2), var(--inset);
  padding: 10px 12px;
  backdrop-filter: var(--blur);
}
.scoreMiniTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
.scoreNamesMini{
  display:flex;
  gap:10px;
  flex: 1 1 240px;
  min-width: 220px;
}
.playerMini{
  flex:1;
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  border-radius: 14px;
  background: rgba(255,255,255,.05);
  border: 1px solid var(--stroke);
}
.playerMini .lbl{
  width:22px; height:22px;
  display:grid; place-items:center;
  border-radius:999px;
  background: rgba(77,163,255,.18);
  border:1px solid rgba(77,163,255,.35);
  font-weight:900;
}
.playerMini input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  color: var(--text);
  font-weight: 800;
  font-size: 14px;
}
.kpisMini{
  gap:8px;
}
.stateMini{
  margin-top:8px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.diagramArea{
  display:flex;
  justify-content:stretch;
  padding: 0;
  width:100%;
}

.courtWrap{
  width: 100%;
  display:flex;
  justify-content:stretch;
  padding: 0;
}
.court{
  position: relative;
  width: min(720px, 100%);
  border-radius: 22px;
  overflow:hidden;
  box-shadow: var(--shadow);
  background: rgba(255,255,255,.02);
  border: 1px solid rgba(255,255,255,.12);
}
.court img{
  width:100%;
  height:auto;
  display:block;
}

.courtQuickBtns{
  position:absolute;
  right: 14px;
  top: 104px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index: 25;
  pointer-events:auto;
}
.quickBtn{
  width: 46px;
  height: 46px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.14);
  background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));
  color: var(--text);
  font-size: 20px;
  font-weight: 1000;
  box-shadow: 0 10px 24px rgba(0,0,0,.22), inset 0 1px 0 rgba(255,255,255,.10);
  backdrop-filter: var(--blur);
}
.quickBtn:active{
  transform: translateY(1px) scale(.98);
}

.tennisBall.inCourt{
  position:absolute;
  top: 12px;
  right: 12px;
  z-index: 30;
}


/* Layout: diagrama + timeline a la derecha */
.diagramArea{
  width:100%;
  padding: 0 12px 18px;
  display:block;
}
.diagramGrid{
  width: min(1180px, 100%);
  margin: 0 auto;
  display:grid;
  grid-template-columns: minmax(320px, 720px) minmax(260px, 420px);
  gap: 16px;
  align-items:start;
}
.courtWrap{
  width: 100%;
  display:flex;
  justify-content:center;
  padding: 0;
}

/* --- v2.44 UI: rail lateral fuera de la pista (estilo broadcast) --- */
.courtWrap.courtRow{
  display: grid;
  grid-template-columns: 1fr 64px;
  gap: 10px;
  align-items: stretch;
  justify-items: center;
}
.courtRail{
  width: 64px;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap: 12px;
}
.courtWrap.courtRow .court{
  width: 100%;
  max-width: 720px;
}
@media (max-width: 520px){
  .courtWrap.courtRow{ grid-template-columns: 1fr 56px; gap: 8px; }
  .courtRail{ width: 56px; }
}
.timelineSide{
  width: 100%;
}
.timelineCard{
  border-radius: 22px;
  overflow:hidden;
  background: rgba(255,255,255,.03);
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: var(--shadow);
  padding: 12px;
  backdrop-filter: var(--blur);
}
.timelineHeader{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap: 10px;
  padding: 4px 2px 10px;
}
.timelineTitle{
  font-weight: 1000;
  font-size: 16px;
}
.timelineSub{
  font-size: 12px;
  color: var(--muted);
  margin-top: 2px;
}

/* Timeline content */
.timelineWrap{ display:flex; flex-direction:column; gap:10px; }
.timeline{ display:flex; flex-wrap:wrap; gap:8px; }
.seqList{
  display:flex;
  flex-direction:column;
  gap:8px;
  max-height: 44vh;
  overflow:auto;
  padding-right: 4px;
}

@media (max-width: 960px){
  .diagramGrid{ grid-template-columns: 1fr; }
  .seqList{ max-height: none; }
}


.modalCard.solid{
  background: rgba(15,23,42,.96);
  backdrop-filter: none !important;
}



}


/* --- Avanzado (menú bola) --- */
.finishMenuTabs{
  display:flex;
  gap:10px;
  padding: 10px 6px 12px;
  margin-bottom: 6px;
  border-bottom: 1px solid rgba(255,255,255,.10);
}
.finishTab{
  flex:1;
  border-radius: 16px;
  padding: 10px 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.04);
  color: rgba(255,255,255,.88);
  font-weight: 900;
}
.finishTab.active{
  border-color: rgba(255,255,255,.28);
  background: rgba(255,255,255,.08);
  box-shadow: 0 10px 28px rgba(0,0,0,.20);
}
.advStep2{
  padding: 10px 6px 6px;
  margin: 8px 0 10px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,.10);
  background: rgba(0,0,0,.18);
  animation: advIn .18s ease-out;
}
@keyframes advIn{
  from{ transform: translateY(10px); opacity: 0; }
  to{ transform: translateY(0); opacity: 1; }
}
.advTitle{
  font-weight: 1000;
  font-size: 14px;
  margin-bottom: 10px;
}
.advChips{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  margin-bottom: 10px;
}
.advChip{
  flex: 1 1 calc(50% - 10px);
  border-radius: 16px;
  padding: 12px 10px;
  border: 1px solid rgba(255,255,255,.16);
  background: rgba(255,255,255,.05);
  color: rgba(255,255,255,.92);
  font-weight: 1000;
  text-align:center;
}
.advChip:active{ transform: translateY(1px) scale(.99); }
.advBackBtn{
  width:100%;
  border-radius: 16px;
  padding: 10px 12px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.03);
  color: rgba(255,255,255,.88);
  font-weight: 1000;
}

@media (max-width: 860px){
  .historyGrid{ flex-direction:column; }
  .historyListCol{ width:100% !important; }
}

/* Analytics */
.analyticsBody{
  display:flex;
  gap: 12px;
  margin-top: 12px;
  flex: 1;
  min-height: 0;
}
.analyticsList{
  width: 46%;
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  background: rgba(0,0,0,.12);
  overflow:auto;
  min-height:0;
}
.analyticsDetail{
  flex: 1;
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 14px;
  background: rgba(0,0,0,.12);
  padding: 12px;
  overflow:auto;
  min-height:0;
}
.analyticsItem{
  padding: 12px;
  border-bottom: 1px solid rgba(255,255,255,.06);
  cursor:pointer;
}
.analyticsItem:hover{ background: rgba(255,255,255,.06); }
.analyticsItem.active{ background: rgba(255,255,255,.10); }
.analyticsItemTitle{ font-weight: 900; }
.analyticsItemMeta{ color: rgba(255,255,255,.70); font-size: 12px; margin-top: 6px; }
@media (max-width: 860px){
  .analyticsBody{ flex-direction:column; }
  .analyticsList{ width: 100%; }
}

/* === Estadísticas (v2.49) === */
.statsCard{ width: min(1100px, 96vw); max-height: 92vh; overflow:hidden; }
.statsFilters{ align-items:end; }
.statsBody{
  padding: 10px 0 2px;
  overflow:auto;
  max-height: calc(92vh - 180px);
}
.statsNote{ padding: 0 2px 10px; color: rgba(255,255,255,.70); font-size: 12px; }
.statsSection{
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 16px;
  background: rgba(0,0,0,.12);
  margin: 10px 0;
  overflow:hidden;
}
.statsSectionTitle{
  padding: 12px 14px;
  font-weight: 900;
  background: rgba(255,255,255,.04);
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.statsSectionHead{
  display:grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  gap: 10px;
  padding: 12px 14px;
  background: rgba(255,255,255,.04);
  border-bottom: 1px solid rgba(255,255,255,.08);
  align-items:center;
}
.statsColHead{ font-weight: 900; }
.statsColHead.mid{ text-align:center; opacity:.95; }
.statsColHead.a{ color:#FFF200; }
.statsColHead.b{ color:#FF2A2A; text-align:right; }
.statsTable{ display:flex; flex-direction:column; }
.statsRow{
  display:grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  gap: 10px;
  padding: 10px 14px;
  border-top: 1px solid rgba(255,255,255,.06);
  align-items:center;
}
.statsRow:first-child{ border-top:none; }
.statsKey{ text-align:center; color: rgba(255,255,255,.88); font-weight: 800; }
.statsVal{ font-variant-numeric: tabular-nums; }
.statsVal.a{ color:#FFF200; }
.statsVal.b{ color:#FF2A2A; text-align:right; }
.statsMuted{ color: rgba(255,255,255,.65); font-weight: 600; }
.statsPill{
  display:inline-flex;
  gap:6px;
  align-items:center;
  padding: 2px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(255,255,255,.06);
}
.statsSmall{ font-size: 12px; opacity:.9; }

.statsHeaderRow{
  display:grid;
  grid-template-columns: 1fr 1.2fr 1fr;
  gap: 10px;
  padding: 10px 2px 8px;
  align-items:center;
  position: sticky;
  top: 0;
  background: rgba(6,16,30,.88);
  backdrop-filter: blur(10px);
  z-index: 3;
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.statsPlayerHead{ font-weight: 1000; }
.statsPlayerHead.a{ color:#FFF200; }
.statsPlayerHead.b{ color:#FF2A2A; text-align:right; }
.statsMidHead{ text-align:center; font-weight: 900; opacity:.80; }
.statsGrid{ display:flex; flex-direction:column; gap: 12px; padding: 0 2px 18px; }
.statsHint{ padding: 0 2px 10px; font-size: 12px; }

.statsDetails{
  border: 1px solid rgba(255,255,255,.10);
  border-radius: 16px;
  background: rgba(0,0,0,.12);
  overflow:hidden;
}
.statsDetails summary{
  padding: 12px 14px;
  font-weight: 900;
  cursor: pointer;
  background: rgba(255,255,255,.04);
  border-bottom: 1px solid rgba(255,255,255,.08);
}
.statsDetails[open] summary{ border-bottom-color: rgba(255,255,255,.12); }
.statsDetails .statsTable{ padding-bottom: 6px; }

@media (max-width: 860px){
  .statsSectionHead, .statsRow{ grid-template-columns: 1fr 1fr 1fr; }
  .statsKey{ font-size: 12px; }
}
@media (max-width: 520px){
  .statsBody{ max-height: calc(92vh - 210px); }
  .statsSectionHead{ padding: 10px 12px; }
  .statsRow{ padding: 10px 12px; }
}


/* === Stats Broadcast Mode (TennisTV style) === */
.broadcastWrap{ padding: 0 2px 18px; display:flex; flex-direction:column; gap:12px; }
.broadcastCard{ border:1px solid rgba(255,255,255,.10); border-radius:16px; overflow:hidden; background: rgba(0,0,0,.10); }
.broadcastHead{ display:flex; justify-content:space-between; align-items:center; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.04); }
.broadcastHead .t{ font-weight:1100; }
.broadcastTable{ width:100%; display:flex; flex-direction:column; }
.broadcastRow{ display:grid; grid-template-columns: 120px 1fr 120px; align-items:center; gap:10px; padding:10px 12px; border-top:1px solid rgba(255,255,255,.08); }
.broadcastRow:first-child{ border-top:none; }
.broadcastL{ color:#FFF200; font-weight:1100; font-variant-numeric: tabular-nums; }
.broadcastR{ color:#FF2A2A; font-weight:1100; text-align:right; font-variant-numeric: tabular-nums; }
.broadcastMid{ display:flex; justify-content:center; }
.broadcastMid span{ min-width: 220px; text-align:center; padding:6px 10px; border-radius: 10px; background: linear-gradient(180deg, rgba(255,210,60,.92), rgba(255,180,20,.88)); color:#1b1b1b; font-weight:1100; letter-spacing:.2px; box-shadow: 0 10px 22px rgba(0,0,0,.22); }
@media (max-width: 520px){
  .broadcastRow{ grid-template-columns: 92px 1fr 92px; }
  .broadcastMid span{ min-width: 160px; font-size: 12px; }
}
/* Print / PDF report */
#printReport{ display:none; }
#printStats{ display:none; }
body.printing #printReport, body.printing #printStats{ display:block; }
body.printing .app{ display:none; }
@media print{
  /*
    IMPORTANT:
    On screen we use html/body {height:100%; overflow:auto}.
    In print mode, that can cause the report to be rendered inside a
    single scrollable page (Chrome shows 1 page with a scrollbar), so
    we must reset height/overflow for proper pagination.
  */
  @page{ size: A4 portrait; margin: 12mm; }

  html, body{
    height: auto !important;
    overflow: visible !important;
  }
  body{
    padding: 0 !important;
    margin: 0 !important;
    background: #fff !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  .app, .modal, .toast, #finishBall{ display:none !important; }
  #printReport,
  #printStats{
    display:block !important;
    height:auto !important;
    max-height:none !important;
    overflow:visible !important;
  }
  #printReport *,
  #printStats *{
    overflow: visible !important;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Avoid cutting point cards across pages */
  #printReport .printNoBreak,
  #printStats .printNoBreak,
  #printReport .miniCourtWrap,
  #printStats .miniCourtWrap{
    break-inside: avoid-page;
    page-break-inside: avoid;
  }
}


/* === Pro TV Scoreboard (v2.37) === */
.scoreTv{
  margin: 10px auto 10px;
  max-width: 980px;
  padding: 14px 14px 12px;
  border-radius: 22px;
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  border: 1px solid rgba(255,255,255,.12);
  box-shadow: 0 18px 50px rgba(0,0,0,.28);
  backdrop-filter: var(--blur);
}

.tvHeader{
  display:grid;
  grid-template-columns: 1fr auto 44px 62px;
  align-items:end;
  gap: 10px;
  padding: 0 6px 6px;
  opacity: .9;
}
.tvHeaderSpacer{height:1px;}
.tvHeaderSets{
  display:flex;
  gap: 6px;
  justify-content:flex-end;
}
.tvHeaderSets:empty{ display:none; }
.tvSetHdr{
  width: 34px;
  text-align:center;
  font-weight: 900;
  font-size: 12px;
  color: rgba(255,255,255,.78);
}
.tvHeaderPts{
  text-align:right;
  font-weight: 900;
  font-size: 12px;
  color: rgba(255,255,255,.78);
}

.tvHeaderGames{
  text-align:center;
  font-weight: 900;
  font-size: 12px;
  color: rgba(255,255,255,.78);
}

.tvRow{
  display:grid;
  grid-template-columns: 1fr 18px auto 44px 62px;
  align-items:center;
  gap: 10px;
  padding: 8px 10px;
  border-radius: 18px;
  background: rgba(0,0,0,.12);
  border: 1px solid rgba(255,255,255,.10);
}
.tvRow .tvName{ grid-column: 1; }
.tvRow .tvServe{ grid-column: 2; }
.tvRow .tvSets{ grid-column: 3; }
.tvRow .tvGames{ grid-column: 4; }
.tvRow .tvPts{ grid-column: 5; }
.tvRow + .tvRow{ margin-top: 4px; }

.tvName{
  display:flex;
  align-items:center;
  gap: 10px;
  min-width: 0;
}
.tvTag{
  width: 28px;
  height: 28px;
  border-radius: 10px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  font-weight: 1000;
  color: rgba(255,255,255,.92);
  background: rgba(255,255,255,.06);
  border: 1px solid rgba(255,255,255,.12);
  flex: 0 0 auto;
}
.scoreTv input{
  width: 100%;
  min-width: 0;
  padding: 6px 6px;
  border-radius: 12px;
  border: 1px solid transparent;
  background: transparent;
  color: rgba(255,255,255,.92);
  font-weight: 900;
  outline: none;
}
.scoreTv input:focus{
  border-color: rgba(255,255,255,.22);
  background: rgba(0,0,0,.14);
  box-shadow: 0 0 0 4px rgba(255,255,255,.06);
}

.tvServe{
  display:flex;
  align-items:center;
  justify-content:center;
}
.serveBall{
  width: 10px;
  height: 10px;
  border-radius: 999px;
  display:inline-block;
  opacity: 0;
  transform: scale(.85);
  transition: opacity .16s ease, transform .16s ease;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.95), rgba(255,255,255,.0) 38%),
    radial-gradient(circle at 55% 60%, rgba(255,230,0,1), rgba(255,230,0,.85) 55%, rgba(255,160,0,.55));
  box-shadow: 0 6px 16px rgba(255,230,0,.35), 0 0 0 2px rgba(0,0,0,.25);
}
.serveBall.on{
  opacity: 1;
  transform: scale(1);
}

.tvSets{
  display:flex;
  gap: 6px;
  justify-content:flex-end;
}
.tvSets:empty{ display:none; }
.tvSetCell{
  width: 26px;
  padding: 6px 0;
  border-radius: 10px;
  text-align:center;
  font-weight: 1000;
  color: rgba(255,255,255,.92);
  background: rgba(255,255,255,.04);
  border: 1px solid rgba(255,255,255,.10);
}
.tvSetCell.active{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.16);
  box-shadow: inset 0 -10px 18px rgba(0,0,0,.18);
}

.tvGames{
  text-align:center;
  font-weight: 1000;
  font-size: 18px;
  height: 40px;
  display:grid;
  place-items:center;
  border-radius: 14px;
  color: rgba(255,255,255,.95);
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.12);
  font-variant-numeric: tabular-nums;
}

.tvPts{
  text-align:center;
  font-weight: 1200;
  font-size: 26px;
  height: 44px;
  display:grid;
  place-items:center;
  border-radius: 16px;
  color: rgba(255,255,255,.96);
  background: rgba(0,0,0,.20);
  border: 1px solid rgba(255,255,255,.14);
  font-variant-numeric: tabular-nums;
}

.tvMeta{
  display:flex;
  gap: 8px;
  justify-content:flex-start;
  padding: 10px 6px 0;
  flex-wrap: wrap;
  opacity: .92;
}
.tvMeta .badge{
  padding: 8px 10px;
  border-radius: 999px;
  font-weight: 900;
}

/* Compact on phones */
@media (max-width: 520px){
  .scoreTv{
    margin: 8px 10px;
    padding: 12px 12px 10px;
  }
  .tvHeader{
    grid-template-columns: 1fr auto 38px 56px;
  }
  .tvSetHdr, .tvSetCell{ width: 24px; border-radius: 10px; }
  .tvGames{ font-size: 16px; height: 38px; }
  .tvPts{ font-size: 22px; height: 42px; }
  .tvTag{ width: 26px; height: 26px; border-radius: 10px;}
  .scoreTv input{ padding: 4px 6px; }
}


/* v2.38: en móvil muy pequeño ocultamos cabecera (labels) */
@media (max-width: 520px){
  .scoreTv .tvHeader{display:none;}
}



/* ==== Flechas de direcciones ==== */
.arrowSvg{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
  z-index: 6; /* encima de pista, debajo de bola y botones */
}
.arrowSvg .arrowLine{
  fill:none;
  stroke-linecap:round;
  stroke-linejoin:round;
}
.arrowSvg .arrowLine.a{ stroke: #FFF200; }
.arrowSvg .arrowLine.b{ stroke: #FF2A2A; }
.arrowSvg .arrowLine.subtle{ opacity:.86; }
.arrowSvg .arrowLine.old{ opacity:.55; }
.arrowSvg .arrowNumCircle{
  fill: rgba(0,0,0,.55);
  stroke-width: 2;
}
.arrowSvg .arrowNumCircle.a{ stroke:#FFF200; }
.arrowSvg .arrowNumCircle.b{ stroke:#FF2A2A; }
.arrowSvg .arrowNumText{
  font-weight: 900;
  font-size: 18px;
  fill: #ffffff;
  dominant-baseline: middle;
  text-anchor: middle;
}
.arrowSvg .draw{
  stroke-dasharray: var(--dash, 1000);
  stroke-dashoffset: var(--dash, 1000);
  animation: dashDraw .28s ease-out forwards;
}
@keyframes dashDraw{ to{ stroke-dashoffset: 0; } }


/* Historial: mini pista con flechas */
.historyDetailTools{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  justify-content:flex-end;
  margin-top: 6px;
}
.miniCourtWrap{ margin: 10px 0 12px; display:flex; flex-direction:column; align-items:center; }
.miniCourt{
  position:relative;
  width: min(520px, 100%);
  aspect-ratio: 1 / 2; /* igual que assets/court_top_view.png (300x600) */
  border-radius: 18px;
  overflow:hidden;
  border: 1px solid rgba(255,255,255,.14);
  background: rgba(0,0,0,.2);
}
.miniCourt img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
}
.miniCourt .arrowSvg{ z-index: 4; }

/* Print (PDF) mini court */
@media print{
  #printReport .miniCourt{
    width: 190px !important;
    border-radius: 10px !important;
    border: 1px solid #cbd5e1 !important;
  }
  #printReport .miniCourtWrap,
  #printStats .miniCourtWrap{ margin: 6px 0 0 !important; }
}


/* --- Modo Pizarra --- */
.boardCard{
  width: min(1100px, 95vw);
  max-height: 92vh;
  overflow: hidden;
  background: linear-gradient(180deg, rgba(16,26,40,0.96), rgba(10,16,26,0.96));
  border: 1px solid rgba(255,255,255,0.10);
  box-shadow: 0 18px 50px rgba(0,0,0,0.55);
}
.boardTopBar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 10px;
  padding: 10px 12px;
  border-top: 1px solid rgba(255,255,255,0.06);
  border-bottom: 1px solid rgba(255,255,255,0.06);
  background: rgba(255,255,255,0.03);
}
.boardLeft{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
.boardRight{ display:flex; gap:10px; align-items:center; }
.boardIcon{
  display:flex; align-items:center; gap:8px;
  padding: 8px 10px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.10);
  background: rgba(255,255,255,0.04);
  color: #eaf1ff;
}
.boardIcon .i{ width: 22px; display:inline-flex; justify-content:center; }
.boardToggle{ display:flex; align-items:center; gap:6px; padding: 4px 8px; border-radius: 14px; background: rgba(0,0,0,0.16); border: 1px solid rgba(255,255,255,0.06); }
.chip.small{ padding: 6px 10px; font-size: 12px; border-radius: 999px; }
.boardCircle{
  width: 42px; height: 42px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.14);
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), rgba(0,0,0,0.18));
  color: #eaf1ff;
  display:flex; align-items:center; justify-content:center;
  box-shadow: 0 10px 22px rgba(0,0,0,0.35);
}
.boardCircle.active{
  outline: 2px solid rgba(255, 220, 80, 0.55);
}
.boardBody{
  display:grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 12px;
  padding: 12px;
  flex: 1;
  min-height: 0;
  overflow: auto;
}

.boardStage{ display:flex; align-items:center; justify-content:center; }
.boardPanel{
  border: 1px solid rgba(255,255,255,0.08);
  border-radius: 18px;
  background: rgba(0,0,0,0.18);
  padding: 12px;
  overflow: hidden;
  display:flex;
  flex-direction:column;
}
.panelTitle{ font-weight: 700; margin-bottom: 6px; }
.seqList{
  flex: 1;
  overflow: auto;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(255,255,255,0.03);
  padding: 8px;
}
.seqItem{
  display:flex; justify-content:space-between; align-items:center;
  padding: 8px 10px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.06);
  background: rgba(0,0,0,0.12);
  margin-bottom: 8px;
  font-weight: 700;
}
.seqItem .n{ opacity: 0.75; font-weight: 800; }
.seqItem .code{ letter-spacing: 0.5px; }
.seqItem.active{ outline: 2px solid rgba(255, 220, 80, 0.45); }
.textInput{
  width: 100%;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.04);
  color: #eaf1ff;
}
.boardCourt .zoneCell, .boardCourt .serveCell{
  border-color: rgba(0, 120, 255, 0.75) !important;
  background: rgba(255,255,255,0.06) !important;
  color: rgba(0, 70, 170, 0.95) !important;
  box-shadow: inset 0 0 0 1px rgba(0,120,255,0.18);
}
.boardCourt .zoneLabel, .boardCourt .serveLabel{
  border-color: rgba(0,120,255,0.65) !important;
  background: rgba(255,255,255,0.85) !important;
  color: rgba(0,70,170,0.98) !important;
}
.boardCourt .zoneCell.disabled, .boardCourt .serveCell.disabled{
  opacity: 0.18 !important;
  filter: none !important;
}
.boardCourt .courtImg{ filter: contrast(1.05) brightness(1.05); }
.previewCourt{ width: min(420px, 100%); }
.previewBox{ padding: 10px 0; }
.twoCol{ display:grid; grid-template-columns: 0.9fr 1.1fr; gap: 12px; }
.listCol{
  border-right: 1px solid rgba(255,255,255,0.08);
  padding-right: 10px;
  overflow:auto;
  max-height: 70vh;
}
.detailCol{ overflow:hidden; }
.patternRow{
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.08);
  background: rgba(0,0,0,0.12);
  margin-bottom: 10px;
  cursor:pointer;
}
.patternRow.active{ outline: 2px solid rgba(255, 220, 80, 0.45); }
@media (max-width: 900px){
  .boardBody{ grid-template-columns: 1fr; height: auto; }
}


/* --- MODO PIZARRA: responsive iPhone / pantallas pequeñas --- */
@media (max-width: 900px){
  .boardBody{ grid-template-columns: 1fr; }
  .boardPanel{ max-height: none; }
}

@media (max-width: 820px){
  .modal{ padding: 0; align-items: stretch; justify-content: stretch; }
  .modalCard.boardCard{
    width: 100vw;
    height: 100dvh;
    max-height: none;
    border-radius: 0;
    padding-bottom: env(safe-area-inset-bottom);
  }
  .boardTopBar{ flex-wrap: wrap; }
  .boardLeft{ width: 100%; display:flex; flex-wrap:wrap; gap: 10px; }
  .boardRight{ margin-left:auto; }
}

/* Fallback para iOS antiguos sin aspect-ratio */
.court::before{
  content:"";
  display:block;
  padding-top: 200%; /* 18/9 = 2.0 */
}
@supports (aspect-ratio: 1 / 1){
  .court::before{ display:none; content:none; padding-top:0; }
}

/* Board rally cells use zoneCell; make label subtle in pizarra */
.boardCourt .zoneLabel{font-size:12px; padding:5px 9px; background: rgba(0,0,0,.22);}

/* === Print PRO: salto de pagina inteligente para export === */
@media print{
  #printReport table thead, #printStats table thead{ display: table-header-group; }
  #printReport table tfoot, #printStats table tfoot{ display: table-footer-group; }

  #printReport .printKeepTogether, #printStats .printKeepTogether{
    break-inside: avoid-page;
    page-break-inside: avoid;
  }
  #printReport .printKeepWithNext, #printStats .printKeepWithNext{
    break-after: avoid-page;
    page-break-after: avoid;
  }
  #printReport .printPageBreakBefore, #printStats .printPageBreakBefore{
    break-before: page;
    page-break-before: always;
  }

  #printReport .printSectionTitle, #printStats .printSectionTitle{
    font-weight: 900 !important;
    font-size: 13px !important;
    margin: 0 0 8px !important;
  }

  #printReport .printPointCard, #printStats .printPointCard{
    border: 1px solid #e2e8f0;
    border-radius: 14px;
    padding: 10px 12px;
    margin: 10px 0;
    break-inside: avoid-page;
    page-break-inside: avoid;
  }
  #printReport .printPointGrid, #printStats .printPointGrid{
    display: grid;
    grid-template-columns: 210px 1fr;
    gap: 14px;
    align-items: start;
  }
  #printReport .printPointTitle, #printStats .printPointTitle{ font-weight: 900; font-size: 12px; }
  #printReport .printPointMeta, #printStats .printPointMeta{ color: #334155; font-size: 11px; margin-top: 4px; }
  #printReport .printPointEnd, #printStats .printPointEnd{ color: #0f172a; font-size: 11px; margin-top: 6px; }
  #printReport .printPointPattern, #printStats .printPointPattern{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono','Courier New', monospace;
    font-size: 11px;
    margin-top: 8px;
  }

  #printReport .printSetDivider, #printStats .printSetDivider{
    border: 2px solid #cbd5e1;
    border-radius: 14px;
    background: #f8fafc;
    padding: 8px 10px;
    margin: 10px 0 6px;
  }
  #printReport .printSetTitle, #printStats .printSetTitle{
    font-weight: 900;
    font-size: 12px;
    color: #0f172a;
  }
}
