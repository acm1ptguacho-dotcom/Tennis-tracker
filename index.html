<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tennis Direction Tracker</title>
  <link rel="stylesheet" href="style.css?v=2462" />
</head>
<body>

<div class="app single" id="appRoot">

  <!-- TOP: men√∫ + nombres + marcador (todo en la misma vista) -->
  <header class="topbar topbarInline">
  <div class="topbarRow">
    <button class="chip iconChip" id="btnMenu" type="button" aria-label="Abrir men√∫">‚ò∞</button>

    <div class="topbarRight">
      <button class="chip warn" id="btnFinish" type="button">Finalizar partido</button>
      <button class="chip good hidden" id="btnResume" type="button">Reanudar partido</button>
      <button class="chip primary" id="btnNew" type="button">Nuevo partido</button>
    </div>
  </div>
</header>

<div class="menuOverlay" id="menuOverlay" aria-hidden="true"></div>
<nav class="drawer" id="drawerMenu" aria-label="Men√∫">
  <div class="drawerHead">
    <div class="drawerTitle">Men√∫</div>
    <button class="chip iconChip" id="btnCloseMenu" type="button" aria-label="Cerrar men√∫">‚úï</button>
  </div>

  <div class="drawerBody">
    <button class="chip" id="btnToggleScore" type="button">Ocultar marcador</button>
    <button class="chip" id="btnRotateCourt" type="button">Rotar pista</button>
    <button class="chip" id="btnBoard" type="button">Modo pizarra</button>

    <div class="drawerDivider"></div>

    <button class="chip" id="btnHistory" type="button">Historial</button>
    <button class="chip" id="btnAnalytics" type="button">Anal√≠ticas</button>
    <button class="chip" id="btnStats" type="button">Estad√≠sticas</button>
    <button class="chip" id="btnExport" type="button">Exportar</button>

    <div class="drawerDivider"></div>

    <button class="chip ghost" id="btnCoach" type="button">Modo normal</button>
    <button class="chip ghost" id="btnTheme" type="button">Modo claro</button>
  </div>
</nav>

  <section class="scoreTv" id="scoreSection">
    <div class="tvHeader">
      <div class="tvHeaderSpacer"></div>
      <div class="tvHeaderSets" id="tvSetHeaders"></div>
      <div class="tvHeaderGames">G</div>
      <div class="tvHeaderPts">Pts</div>
    </div>

    <div class="tvRow" id="tvRowA">
      <div class="tvName">
        <span class="tvTag">A</span>
        <input id="nameA" value="Jugador A" />
      </div>
      <div class="tvServe"><span class="serveBall" id="serveA" aria-label="Servidor A"></span></div>
      <div class="tvSets" id="setsRowA"></div>
      <div class="tvGames" id="tvGamesA">0</div>
      <div class="tvPts" id="tvPtsA">0</div>
    </div>

    <div class="tvRow" id="tvRowB">
      <div class="tvName">
        <span class="tvTag">B</span>
        <input id="nameB" value="Jugador B" />
      </div>
      <div class="tvServe"><span class="serveBall" id="serveB" aria-label="Servidor B"></span></div>
      <div class="tvSets" id="setsRowB"></div>
      <div class="tvGames" id="tvGamesB">0</div>
      <div class="tvPts" id="tvPtsB">0</div>
    </div>
</section>

  <!-- DIAGRAMA + TIMELINE (lado derecho) -->
  <main class="diagramArea">
    <div class="diagramGrid">
      <div class="courtWrap courtRow">
      <div class="court" id="court">
        <div class="courtSurface" id="courtSurface">
          <img src="assets/court_top_view.png" alt="pista" id="courtImg">

          <!-- overlay flechas (direcciones) -->
          <svg id="arrowSvg" class="arrowSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none" aria-hidden="true"></svg>

          <div class="zoneLayer" id="zoneLayer"></div>

          <!-- nombres en el fondo (dentro del verde) -->
          <div class="baselineName baselineTop" id="baselineTop">Jugador B</div>
          <div class="baselineName baselineBottom" id="baselineBottom">Jugador A</div>
        </div>
<!-- bot√≥n de acciones (confirmar / finalizar punto) -->
        <button id="finishBall" class="tennisBall inCourt fab" type="button" aria-label="Acciones del punto">‚úì</button>
      </div>

      <!-- rail lateral: evita tapar zonas clicables en m√≥vil -->
      <div class="courtRail" aria-label="Acciones r√°pidas">
        <button class="quickBtn" id="btnUndo" type="button" title="Deshacer √∫ltimo golpe">‚Ü∂</button>
        <button class="quickBtn" id="btnRedoPoint" type="button" title="Rehacer √∫ltimo punto">‚Ü∑</button>
        <button class="quickBtn" id="btnResetPoint" type="button" title="Reiniciar punto">‚ü≤</button>
      </div>
    
      </div>

      <aside class="timelineSide" id="timelineSide" aria-label="Timeline del rally">
        <div class="timelineCard">
          <div class="timelineHeader">
            <div class="timelineHeaderText">
              <div class="timelineTitle">Secuencia del punto</div>
              <div class="timelineSub" id="lastTouch">√öltimo: ‚Äî</div>
            </div>
          </div>

          <div class="timelineWrap">
            <div class="timeline" id="timeline"></div>
            <div class="seqList" id="seqList"></div>
          </div>

          <details class="legend" open>
      <summary>C√≥digos rally</summary>
      <div class="legendGrid">
        <div><b>Direcci√≥n</b>: C=Cruzado, P=Paralelo, M=Medio</div>
        <div><b>Profundidad</b>: P=Profundo, M=Medio, C=Corto</div>
        <div><b>Ejemplos</b>: CP=Cruzado Profundo, CC=Cruzado Corto, PP=Paralelo Profundo</div>
        <div><b>Saque</b>: SD/SV + T/C/A</div>
      </div>
    </details>
        </div>
      </aside>
    </div>
  </main>

</div>


<!-- Men√∫ de acciones (bola) -->
<div class="finishMenu hidden" id="finishMenu" role="dialog" aria-modal="true" aria-label="Acciones del punto">
  <div class="finishMenuCard">
    <button class="finishMenuClose" id="finishMenuClose" type="button" aria-label="Cerrar">‚úï</button>

    
    <div class="finishMenuTabs" role="tablist" aria-label="Modo de registro">
      <button class="finishTab active" id="tabNormal" type="button" role="tab" aria-selected="true">Normal</button>
      <button class="finishTab" id="tabAdvanced" type="button" role="tab" aria-selected="false">Avanzado</button>
    </div>

<div class="finishMenuTitle">Acciones del punto</div>
    <div class="finishMenuSub">Selecciona una opci√≥n (se cierra autom√°ticamente)</div>

    
    <div class="advStep2 hidden" id="advStep2" aria-label="Detalle avanzado">
      <div class="advTitle" id="advTitle">Detalle</div>
      <div class="advChips" id="advChips"></div>
      <button class="advBackBtn" id="advBack" type="button">‚Üê Volver</button>
    </div>

<div class="finishGroup" id="finishServeGroup">
      <div class="finishGroupTitle">Saque</div>
      <div class="finishMenuGrid two">
        <button class="finishBtn" id="mFault" type="button">Falta</button>
        <button class="finishBtn bad" id="mDoubleFault" type="button">Doble falta</button>
      </div>
    </div>

    <div class="finishGroup" id="finishRallyGroup">
      <div class="finishGroupTitle">Finalizar punto</div>
      <div class="finishMenuGrid">
        <button class="finishBtn bad" id="mUeA" type="button">Error no forzado (A)</button>
        <button class="finishBtn bad" id="mUeB" type="button">Error no forzado (B)</button>
        <button class="finishBtn warn" id="mFeA" type="button">Error forzado (A)</button>
        <button class="finishBtn warn" id="mFeB" type="button">Error forzado (B)</button>
        <button class="finishBtn good" id="mWinA" type="button">Winner (A)</button>
        <button class="finishBtn good" id="mWinB" type="button">Winner (B)</button>
      </div>
    </div>
  </div>
</div>

<!-- MODALS -->
<div class="modal hidden" id="historyModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Historial del partido</div>
        <div class="muted" id="historySub">0 puntos</div>
      </div>
      <button class="chip" id="btnCloseHistory" type="button">Cerrar</button>
    </div>

    <div class="filters">
      <label>Servidor <select id="fServer"><option value="">Todos</option><option value="A">A</option><option value="B">B</option></select></label>
      <label>Lado <select id="fSide"><option value="">Todos</option><option value="SD">SD</option><option value="SV">SV</option></select></label>
      <label>Ganador <select id="fWinner"><option value="">Todos</option><option value="A">A</option><option value="B">B</option></select></label>
      <label>Final <select id="fEnd"><option value="">Todos</option><option value="Winner">Winner</option><option value="Error no forzado">Error no forzado</option><option value="Error forzado">Error forzado</option><option value="Doble falta">Doble falta</option></select></label>
      <label class="search">Buscar patr√≥n <input id="fSearch" placeholder="Ej: A-CP - B-CP"></label>
    </div>

    <div class="historyHint muted">Toca un punto para ver el diagrama en pantalla completa y reproducirlo.</div>
    <div class="historyList historyListFull" id="historyList"></div>
  </div>
</div>

<!-- Visor de punto (pantalla completa) -->
<div class="modal hidden" id="pointViewerModal">
  <div class="modalCard solid pointCard">
    <div class="modalHead">
      <div style="min-width:0;">
        <div class="modalTitle" id="pvTitle">Punto</div>
        <div class="muted" id="pvSub">‚Äî</div>
      </div>
      <button class="chip" id="btnClosePointViewer" type="button">Cerrar</button>
    </div>

    <div class="pointViewerBody">
      <div class="pointViewerTools">
        <button class="chip" id="btnPvToggleArrows" type="button">Flechas: ON</button>
        <button class="chip" id="btnPvReplay" type="button">Reproducir</button>
      </div>

      <div class="pointViewerCourtWrap">
        <div class="pointViewerCourt" id="pvCourt" aria-label="Diagrama del punto">
          <img src="assets/court_top_view.png" alt="pista">
          <svg id="pvArrowSvg" class="arrowSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none" aria-hidden="true"></svg>
          <div class="baselineName baselineTop" id="pvTopName">Jugador B</div>
          <div class="baselineName baselineBottom" id="pvBottomName">Jugador A</div>
        </div>
      </div>

      <details class="pointViewerDetails" id="pvDetails">
        <summary>Detalles del punto</summary>
        <div class="pointViewerEvents" id="pvEvents"></div>
      </details>
    </div>
  </div>
</div>

<div class="modal hidden" id="analyticsModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Anal√≠ticas del partido</div>
        <div class="muted">Top patrones</div>
      </div>
      <button class="chip" id="btnCloseAnalytics" type="button">Cerrar</button>
    </div>

    <div class="filters">
      <label>Vista
        <select id="aView">
          <option value="freq">M√°s repetidos</option>
          <option value="effective">M√°s efectivos</option>
          <option value="deucead">DEUCE vs AD</option>
          <option value="server">Por servidor</option>
        </select>
      </label>
      <label>M√≠n. ocurrencias
        <select id="aMin">
          <option value="1">1</option>
          <option value="3">3</option>
          <option value="5" selected>5</option>
          <option value="8">8</option>
        </select>
      </label>
      <label class="check"><input type="checkbox" id="aIncludeServe" checked> Incluir saque</label>
    </div>

    <div class="analyticsBody">
      <div class="analyticsList" id="analyticsList"></div>
      <div class="analyticsDetail" id="analyticsDetail">Selecciona un patr√≥n.</div>
    </div>
  </div>
</div>

<div class="modal hidden" id="statsModal">
  <div class="modalCard solid statsCard">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Estad√≠sticas del partido</div>
        <div class="muted" id="statsSub">‚Äî</div>
      </div>
      <button class="chip" id="btnCloseStats" type="button">Cerrar</button>
    </div>

    <div class="filters statsFilters">
      <label>Rango
        <select id="sRange">
          <option value="all" selected>Partido</option>
          <option value="10">√öltimos 10</option>
          <option value="25">√öltimos 25</option>
          <option value="50">√öltimos 50</option>
        </select>
      </label>

      <label>Set
        <select id="sSet">
          <option value="all" selected>Todos</option>
        </select>
      </label>

      <label>Servidor
        <select id="sServer">
          <option value="" selected>Todos</option>
          <option value="A">A</option>
          <option value="B">B</option>
        </select>
      </label>

      <label>Situaci√≥n
        <select id="sContext">
          <option value="all" selected>Todas</option>
          <option value="bp">Break points</option>
          <option value="deuce">Deuce/Adv</option>
          <option value="3030">30-30+</option>
        </select>
      </label>
    </div>

    <div class="statsBody" id="statsBody"></div>
  </div>
</div>

<div class="modal hidden" id="exportModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Exportar</div>
        <div class="muted" id="exportSub">Puntos y patrones</div>
      </div>
      <button class="chip" id="btnCloseExport" type="button">Cerrar</button>
    </div>

    <div class="exportGrid">
      <button class="btn" id="btnCSV" type="button">Exportar CSV</button>
      <button class="btn" id="btnWord" type="button">Tabla Word (HTML)</button>
      <button class="btn primary" id="btnPDF" type="button">PDF premium (imprimir)</button>
    </div>
    <div class="muted">Tip: en PDF premium usa ‚ÄúImprimir ‚Üí Guardar como PDF‚Äù.</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- placeholders (compatibilidad) -->
<div id="serveActions" class="hidden"></div>
<div id="finishActions" class="hidden"></div>
<button id="btnFault" class="hidden" type="button"></button>
<button id="btnDoubleFault" class="hidden" type="button"></button>
<button id="btnUeA" class="hidden" type="button"></button>
<button id="btnUeB" class="hidden" type="button"></button>
<button id="btnFeA" class="hidden" type="button"></button>
<button id="btnFeB" class="hidden" type="button"></button>
<button id="btnWinA" class="hidden" type="button"></button>
<button id="btnWinB" class="hidden" type="button"></button>

<script src="app.js?v=2462"></script>

<div class="modal hidden" id="boardModal">
  <div class="modalCard boardCard">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Modo pizarra</div>
        <div class="muted">Crea y guarda patrones propios (play/pausa/loop/editar).</div>
      </div>
      <div class="modalActions">
        <button class="chip" id="btnBoardClose" type="button">Cerrar</button>
      </div>
    </div>

    <div class="boardTopBar">
      <div class="boardLeft">
        <button class="boardIcon" id="btnBoardMy" type="button" title="Mis patrones">
          <span class="i">üìö</span><span>Mis patrones</span>
        </button>
        <button class="boardIcon" id="btnBoardNew" type="button" title="Nuevo patr√≥n">
          <span class="i">‚úèÔ∏è</span><span>Nuevo</span>
        </button>

        <div class="boardToggle">
          <span class="muted">Inicio:</span>
          <button class="chip small" id="btnBoardStartServe" type="button">Saque</button>
          <button class="chip small" id="btnBoardStartRally" type="button">Rally</button>
        </div>

        <div class="boardToggle" id="boardServeControls">
          <span class="muted">Servidor:</span>
          <button class="chip small" id="btnBoardSrvA" type="button">A</button>
          <button class="chip small" id="btnBoardSrvB" type="button">B</button>
          <span class="muted">Lado:</span>
          <button class="chip small" id="btnBoardSideD" type="button">DEUCE</button>
          <button class="chip small" id="btnBoardSideA" type="button">AD</button>
        </div>

        <div class="boardToggle hidden" id="boardRallyControls">
          <span class="muted">Empieza golpeando:</span>
          <button class="chip small" id="btnBoardStartA" type="button">A</button>
          <button class="chip small" id="btnBoardStartB" type="button">B</button>
        </div>
      </div>

      <div class="boardRight">
        <button class="boardCircle" id="btnBoardPlay" type="button" title="Play">
          <span>‚ñ∂</span>
        </button>
        <button class="boardCircle" id="btnBoardPause" type="button" title="Pausa">
          <span>‚è∏</span>
        </button>
        <button class="boardCircle" id="btnBoardLoop" type="button" title="Loop">
          <span>üîÅ</span>
        </button>
        <button class="boardCircle" id="btnBoardEdit" type="button" title="Editar">
          <span>üõ†</span>
        </button>
        <button class="boardCircle hidden" id="btnBoardSave" type="button" title="Guardar">
          <span>üíæ</span>
        </button>
        <button class="boardCircle hidden" id="btnBoardCancel" type="button" title="Cancelar">
          <span>‚úñ</span>
        </button>
        <button class="boardCircle hidden" id="btnBoardUndo" type="button" title="Deshacer">
          <span>‚Ü©</span>
        </button>
      </div>
    </div>

    <div class="boardBody">
      <div class="boardStage">
        <div class="court boardCourt" id="boardCourt">
          <img class="courtImg" id="boardCourtImg" src="assets/board_court.png" alt="Pizarra court" />
          <svg class="arrowSvg" id="boardArrowSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none"></svg>
          <div class="zoneLayer" id="boardZoneLayer"></div>
          <div class="baselineName top" id="boardNameTop">Jugador B</div>
          <div class="baselineName bottom" id="boardNameBottom">Jugador A</div>
        </div>
      </div>

      <div class="boardPanel">
        <div class="panelTitle">Secuencia</div>
        <div class="muted small" id="boardSeqHint">Toca zonas para crear el patr√≥n.</div>
        <div class="seqList" id="boardSeqList"></div>
        <div class="divider"></div>
        <div class="panelTitle">Guardar en ‚ÄúMis patrones‚Äù</div>
        <div class="row">
          <input class="textInput" id="boardPatternName" placeholder="Nombre del patr√≥n (ej: Saque abierto + derecha a la red)" />
          <button class="chip good" id="btnBoardQuickSave" type="button">Guardar</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal hidden" id="boardPatternsModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Mis patrones</div>
        <div class="muted" id="boardPatternsSub">0 patrones</div>
      </div>
      <div class="modalActions">
        <button class="chip" id="btnCloseBoardPatterns" type="button">Cerrar</button>
      </div>
    </div>
    <div class="twoCol">
      <div class="listCol" id="boardPatternsList"></div>
      <div class="detailCol">
        <div class="panelTitle">Vista previa</div>
        <div class="muted small">Selecciona un patr√≥n para previsualizar y cargar.</div>
        <div class="previewBox">
          <div class="court boardCourt previewCourt" id="boardPreviewCourt">
            <img class="courtImg" src="assets/board_court.png" alt="Preview" />
            <svg class="arrowSvg" id="boardPreviewArrowSvg" viewBox="0 0 1000 1000" preserveAspectRatio="none"></svg>
          </div>
        </div>
        <div class="row">
          <button class="chip good" id="btnBoardLoadSelected" type="button">Cargar</button>
          <button class="chip warn" id="btnBoardDeleteSelected" type="button">Eliminar</button>
        </div>
        <div class="divider"></div>
        <div class="panelTitle">Secuencia</div>
        <div class="seqList" id="boardPatternsSeq"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
