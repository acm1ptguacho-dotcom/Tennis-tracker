<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tennis Direction Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">
        <span class="logoDot"></span>
        <div>
          <b>Tennis Direction Tracker</b><br/>
          <small class="muted">Tracking de direcciones en directo</small>
        </div>
      </div>

      <div class="chips">
        <button class="chip ghost" id="btnTheme">Modo claro</button>
        <button class="chip ghost" id="btnCoach">Modo entrenador</button>
        <button class="chip" id="btnHistory">Historial</button>
        <button class="chip" id="btnAnalytics">Analíticas</button>
        <button class="chip" id="btnExport">Exportar</button>
        <button class="chip warn" id="btnFinish">Finalizar partido</button>
        <button class="chip good hidden" id="btnResume">Reanudar partido</button>
        <button class="chip primary" id="btnNew">Nuevo partido</button>
      
    <div class="scorebar">
      <div class="section" id="scoreSection">
        <div class="row">
          <div class="playerCard">
            <label>Jugador A</label>
            <input id="nameA" value="Jugador A" />
          </div>
          <div class="playerCard">
            <label>Jugador B</label>
            <input id="nameB" value="Jugador B" />
          </div>
        </div>
    </div>
</div>
    </div>

        <div class="mainLeft">
      <div class="section diagramOnly">
        <div class="courtWrap">
        <div class="court" id="court">
          <img src="assets/court_top_view.png" alt="pista" id="courtImg">
          <div class="zoneLayer" id="zoneLayer"></div>
          <div class="zoneLabel" id="zoneHint">Toca en pista</div>
        </div>
      </div>
      </div>
    </div>

    <div class="mainRight">
      

        <div class="kpis">
          <div class="kpi"><div class="t">Sets</div><div class="v" id="setsA">0</div></div>
          <div class="kpi"><div class="t">Games</div><div class="v" id="gamesA">0</div></div>
          <div class="kpi"><div class="t">Pts</div><div class="v" id="ptsA">0</div></div>
          <div class="kpi"><div class="t">Pts</div><div class="v" id="ptsB">0</div></div>
          <div class="kpi"><div class="t">Games</div><div class="v" id="gamesB">0</div></div>
          <div class="kpi"><div class="t">Sets</div><div class="v" id="setsB">0</div></div>
        </div>
        <div class="statusBar">
        <span class="statusBadge" id="badgeScore">DEUCE</span>
        <span class="statusBadge" id="badgeServer">Servidor: A</span>
        <span class="statusBadge" id="badgeSide">SD</span>
        <span class="muted smallHide" id="badgePhase">SAQUE</span>
        <span class="muted smallHide" id="lastTouch">Último: —</span>
      </div>
      </div>

      <div class="section" id="serveActions">
        <div class="modalTitle">Saque</div>
        <div class="modalSub">Primer golpe · marca T/C/A dentro del cuadro</div>
        <div class="gridBtns" style="margin-top:10px;">
          <button class="btn btnBig bad" id="btnFault">Falta</button>
          <button class="btn btnBig bad" id="btnDoubleFault">Doble falta</button>
        </div>
      </div>

      <div class="section hidden" id="finishActions">
        <div class="modalTitle">Finalizar punto</div>
        <div class="modalSub">Indica quién gana / pierde el punto</div>
        <div class="gridBtns" style="margin-top:10px;">
          <button class="btn btnBig bad" id="btnUeA">Error no forzado (A)</button>
          <button class="btn btnBig bad" id="btnUeB">Error no forzado (B)</button>
          <button class="btn btnBig warn" id="btnFeA">Error forzado (A)</button>
          <button class="btn btnBig warn" id="btnFeB">Error forzado (B)</button>
          <button class="btn btnBig good" id="btnWinA">Winner (A)</button>
          <button class="btn btnBig good" id="btnWinB">Winner (B)</button>
        </div>
      </div>

      <div class="section">
        <div class="row" style="justify-content:space-between; align-items:center;">
          <div>
            <div class="modalTitle">Timeline del rally</div>
            <div class="modalSub">Toques en orden · <span class="muted">▶ reproduce el punto</span></div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;">
            <button class="btn btnBig soft" id="btnReplay">▶ Reproducir</button>
            <button class="btn btnBig soft" id="btnUndo">Deshacer</button>
            <button class="btn btnBig soft" id="btnResetPoint">Reiniciar punto</button>
            <button class="btn btnBig soft" id="btnRedoPoint">Rehacer último punto</button>
          </div>
        </div>

        <div class="timeline" id="timeline"></div>
        <div class="seqList" id="seqList"></div>
      </div>

            <div class="section" id="legendSection">
        <div class="modalTitle">Leyenda de nomenclaturas</div>
        <div class="modalSub">Referencia rápida de códigos</div>
        <div class="legendGrid">
          <div class="legendItem"><b>P</b><span>Profundo</span></div>
          <div class="legendItem"><b>M</b><span>Medio</span></div>
          <div class="legendItem"><b>C</b><span>Corto</span></div>
          <div class="legendItem"><b>CP</b><span>Cruzado profundo</span></div>
          <div class="legendItem"><b>CM</b><span>Cruzado medio</span></div>
          <div class="legendItem"><b>CC</b><span>Cruzado corto</span></div>
          <div class="legendItem"><b>PP</b><span>Paralelo profundo</span></div>
          <div class="legendItem"><b>PM</b><span>Paralelo medio</span></div>
          <div class="legendItem"><b>PC</b><span>Paralelo corto</span></div>
          <div class="legendItem"><b>MV</b><span>Medio por ventaja</span></div>
          <div class="legendItem"><b>R</b><span>Resto (primer golpe)</span></div>
          <div class="legendItem"><b>S SD/SV T/C/A</b><span>Saque: DEUCE/AD + T/C/A</span></div>
        </div>
        <details class="legendMore">
          <summary>Ver ejemplos</summary>
          <div class="legendExamples">
            <div>Ej: <b>A-S SD T</b> = Saque de A desde DEUCE a la T</div>
            <div>Ej: <b>B-R CP</b> = Resto de B cruzado profundo</div>
            <div>Ej: <b>A-PP</b> = A paralelo profundo</div>
          </div>
        </details>
      </div>
    </div></div>
  </div>

  <!-- History modal -->
  <div class="modal hidden" id="historyModal">
    <div class="modalCard">
      <div class="modalHeader">
        <div>
          <div class="modalTitle">Historial del partido</div>
          <div class="modalSub" id="historySub">0 puntos</div>
        </div>
        <button class="chip" id="btnCloseHistory">Cerrar</button>
      </div>
      <div class="modalBody">
        <div class="filters">
          <label>Servidor</label>
          <select id="fServer">
            <option value="">Todos</option>
            <option value="A">Saca A</option>
            <option value="B">Saca B</option>
          </select>
          <label>Lado</label>
          <select id="fSide">
            <option value="">Todos</option>
            <option value="SD">DEUCE</option>
            <option value="SV">AD</option>
          </select>
          <label>Ganador</label>
          <select id="fWinner">
            <option value="">Todos</option>
            <option value="A">Gana A</option>
            <option value="B">Gana B</option>
          </select>
          <label>Final</label>
          <select id="fEnd">
            <option value="">Todos</option>
            <option value="Winner">Winner</option>
            <option value="Error no forzado">Error no forzado</option>
            <option value="Error forzado">Error forzado</option>
            <option value="Doble falta">Doble falta</option>
          </select>
          <label>Buscar patrón</label>
          <input id="fSearch" placeholder="Ej: A-CP - B-CP" />
        </div>

        <div class="historyGrid">
  <div class="historyCol historyListCol">
    <div id="historyList" class="historyList"></div>
  </div>
  <div class="historyCol historyDetailCol">
    <div id="historyDetail" class="historyDetail">Selecciona un punto.</div>
  </div>
</div>
        <div class="muted" style="margin-top:10px;">Tip: escribe “A-CP” o “B-R CP” para filtrar rápido.</div>
      </div>
    </div>
  </div>

  <!-- Analytics modal -->
  <div class="modal hidden" id="analyticsModal">
    <div class="modalCard">
      <div class="modalHeader">
        <div>
          <div class="modalTitle">Analíticas del partido</div>
          <div class="modalSub">Top patrones · dominancia · deuce/ad · por servidor</div>
        </div>
        <button class="chip" id="btnCloseAnalytics">Cerrar</button>
      </div>
      <div class="modalBody">
        <div class="filters">
          <label>Vista</label>
          <select id="aView">
            <option value="freq">Más repetidos</option>
            <option value="eff">Más efectivos (% éxito)</option>
            <option value="deucead">DEUCE vs AD</option>
            <option value="server">Por servidor</option>
          </select>
          <label>Mín. ocurrencias</label>
          <select id="aMin">
            <option>2</option><option>3</option><option selected>5</option><option>8</option><option>10</option>
          </select>
          <label><input type="checkbox" id="aIncludeServe" checked /> Incluir saque</label>
        </div>

        <table class="table" id="analyticsTable">
          <thead>
            <tr>
              <th>Patrón</th><th>Veces</th><th>Gana A</th><th>Gana B</th><th>Dominante</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>

        <div class="section" style="margin-top:12px;">
          <div class="modalTitle">Detalle</div>
          <div class="modalSub">Clic en un patrón para ver secuencia y puntos</div>
          <div id="analyticsDetail" class="muted" style="margin-top:8px;">Selecciona un patrón.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Export modal -->
  <div class="modal hidden" id="exportModal">
    <div class="modalCard">
      <div class="modalHeader">
        <div>
          <div class="modalTitle">Exportar</div>
          <div class="modalSub" id="exportSub">Tabla punto a punto</div>
        </div>
        <button class="chip" id="btnCloseExport">Cerrar</button>
      </div>
      <div class="modalBody">
        <div class="filters">
          <label><input type="checkbox" id="eIncludeServe" checked /> Incluir saque</label>
          <label><input type="checkbox" id="eSplitShots" checked /> Columnas por golpe</label>
          <label>Brand</label>
          <input id="eBrand" value="Tennis Direction Tracker" />
        </div>

        <div class="row" style="margin-top:10px; justify-content:flex-end;">
          <button class="btn btnBig primary" id="btnCSV">Descargar Excel (CSV)</button>
          <button class="btn btnBig soft" id="btnWord">Descargar Word (tabla)</button>
          <button class="btn btnBig soft" id="btnPDF">Export PDF (premium)</button>
        </div>

        <div class="muted" style="margin-top:10px;">PDF abre una vista premium lista para “Imprimir → Guardar como PDF”.</div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">OK</div>

  <script src="app.js"></script>

  <!-- Floating tennis ball finish menu -->
  <button id="finishBall" class="tennisBall" type="button" aria-label="Finalizar punto"></button>
  <div id="finishMenu" class="finishMenu hidden" role="dialog" aria-modal="true">
    <div class="finishMenuCard">
      <button id="finishMenuClose" class="finishMenuClose" type="button" aria-label="Cerrar">×</button>
      <div class="finishMenuTitle">Finalizar punto</div>
      <div class="finishMenuSub">Selecciona el resultado (se cierra automáticamente)</div>

      <div class="finishMenuGrid">
        <button class="finishBtn bad" id="mUeA" type="button">Error no forzado (A)</button>
        <button class="finishBtn bad" id="mUeB" type="button">Error no forzado (B)</button>
        <button class="finishBtn warn" id="mFeA" type="button">Error forzado (A)</button>
        <button class="finishBtn warn" id="mFeB" type="button">Error forzado (B)</button>
        <button class="finishBtn good" id="mWinA" type="button">Winner (A)</button>
        <button class="finishBtn good" id="mWinB" type="button">Winner (B)</button>
      </div>
    </div>
  </div>

</body>
</html>
