<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Tennis Direction Tracker</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div class="app single" id="appRoot">

  <!-- TOP: menú + nombres + marcador (todo en la misma vista) -->
  <header class="topbar topbarInline">
    <div class="chips chipsScroll">
      <button class="chip ghost" id="btnTheme" type="button">Modo claro</button>
      <button class="chip ghost" id="btnCoach" type="button">Modo entrenador</button>

      <button class="chip" id="btnHistory" type="button">Historial</button>
      <button class="chip" id="btnAnalytics" type="button">Analíticas</button>
      <button class="chip" id="btnExport" type="button">Exportar</button>
      <button class="chip warn" id="btnFinish" type="button">Finalizar partido</button>
      <button class="chip good hidden" id="btnResume" type="button">Reanudar partido</button>
      <button class="chip primary" id="btnNew" type="button">Nuevo partido</button>
    </div>
  </header>

  <section class="scoreMini" id="scoreSection">
    <div class="scoreMiniTop">
      <div class="scoreNamesMini">
        <div class="playerMini">
          <span class="lbl">A</span>
          <input id="nameA" value="Jugador A" />
        </div>
        <div class="playerMini">
          <span class="lbl">B</span>
          <input id="nameB" value="Jugador B" />
        </div>
      </div>

      <div class="kpis kpisMini">
        <div class="kpi"><div class="t">S</div><div class="v" id="setsA">0</div></div>
        <div class="kpi"><div class="t">G</div><div class="v" id="gamesA">0</div></div>
        <div class="kpi"><div class="t">P</div><div class="v" id="ptsA">0</div></div>

        <div class="kpi"><div class="t">P</div><div class="v" id="ptsB">0</div></div>
        <div class="kpi"><div class="t">G</div><div class="v" id="gamesB">0</div></div>
        <div class="kpi"><div class="t">S</div><div class="v" id="setsB">0</div></div>
      </div>
    </div>

    <div class="stateLine stateMini">
      <span class="badge" id="badgeScore">0-0</span>
      <span class="badge" id="badgeServer">Servidor: A</span>
      <span class="badge" id="badgeSide">SD</span>
      <span class="badge" id="badgePhase">SAQUE</span>
    </div>
  </section>

  <!-- DIAGRAMA + TIMELINE (lado derecho) -->
  <main class="diagramArea">
    <div class="diagramGrid">
      <div class="courtWrap">
      <div class="court" id="court">
        <img src="assets/court_top_view.png" alt="pista" id="courtImg">

        <div class="zoneLayer" id="zoneLayer"></div>
        <div class="zoneLabel" id="zoneHint">Toca en pista</div>

        <!-- bola de acciones (saque/finalización) -->
        <button id="finishBall" class="tennisBall inCourt" type="button" aria-label="Acciones del punto"></button>

        <!-- botones rápidos (en el margen derecho del diagrama) -->
        <div class="courtQuickBtns" aria-label="Acciones rápidas">
          <button class="quickBtn" id="btnUndo" type="button" title="Deshacer último golpe">↶</button>
          <button class="quickBtn" id="btnRedoPoint" type="button" title="Rehacer último punto">↷</button>
          <button class="quickBtn" id="btnResetPoint" type="button" title="Reiniciar punto">⟲</button>
        </div>
      </div>
    
      </div>

      <aside class="timelineSide" id="timelineSide" aria-label="Timeline del rally">
        <div class="timelineCard">
          <div class="timelineHeader">
            <div class="timelineHeaderText">
              <div class="timelineTitle">Secuencia del punto</div>
              <div class="timelineSub" id="lastTouch">Último: —</div>
            </div>
          </div>

          <div class="timelineWrap">
            <div class="timeline" id="timeline"></div>
            <div class="seqList" id="seqList"></div>
          </div>

          <details class="legend" open>
      <summary>Códigos rally</summary>
      <div class="legendGrid">
        <div><b>Dirección</b>: C=Cruzado, P=Paralelo, M=Medio</div>
        <div><b>Profundidad</b>: P=Profundo, M=Medio, C=Corto</div>
        <div><b>Ejemplos</b>: CP=Cruzado Profundo, CC=Cruzado Corto, PP=Paralelo Profundo</div>
        <div><b>Saque</b>: SD/SV + T/C/A</div>
      </div>
    </details>
        </div>
      </aside>
    </div>
  </main>

</div>


<!-- Menú de acciones (bola) -->
<div class="finishMenu hidden" id="finishMenu" role="dialog" aria-modal="true" aria-label="Acciones del punto">
  <div class="finishMenuCard">
    <button class="finishMenuClose" id="finishMenuClose" type="button" aria-label="Cerrar">✕</button>

    
    <div class="finishMenuTabs" role="tablist" aria-label="Modo de registro">
      <button class="finishTab active" id="tabNormal" type="button" role="tab" aria-selected="true">Normal</button>
      <button class="finishTab" id="tabAdvanced" type="button" role="tab" aria-selected="false">Avanzado</button>
    </div>

<div class="finishMenuTitle">Acciones del punto</div>
    <div class="finishMenuSub">Selecciona una opción (se cierra automáticamente)</div>

    
    <div class="advStep2 hidden" id="advStep2" aria-label="Detalle avanzado">
      <div class="advTitle" id="advTitle">Detalle</div>
      <div class="advChips" id="advChips"></div>
      <button class="advBackBtn" id="advBack" type="button">← Volver</button>
    </div>

<div class="finishGroup" id="finishServeGroup">
      <div class="finishGroupTitle">Saque</div>
      <div class="finishMenuGrid two">
        <button class="finishBtn" id="mFault" type="button">Falta</button>
        <button class="finishBtn bad" id="mDoubleFault" type="button">Doble falta</button>
      </div>
    </div>

    <div class="finishGroup" id="finishRallyGroup">
      <div class="finishGroupTitle">Finalizar punto</div>
      <div class="finishMenuGrid">
        <button class="finishBtn bad" id="mUeA" type="button">Error no forzado (A)</button>
        <button class="finishBtn bad" id="mUeB" type="button">Error no forzado (B)</button>
        <button class="finishBtn warn" id="mFeA" type="button">Error forzado (A)</button>
        <button class="finishBtn warn" id="mFeB" type="button">Error forzado (B)</button>
        <button class="finishBtn good" id="mWinA" type="button">Winner (A)</button>
        <button class="finishBtn good" id="mWinB" type="button">Winner (B)</button>
      </div>
    </div>
  </div>
</div>

<!-- MODALS -->
<div class="modal hidden" id="historyModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Historial del partido</div>
        <div class="muted" id="historySub">0 puntos</div>
      </div>
      <button class="chip" id="btnCloseHistory" type="button">Cerrar</button>
    </div>

    <div class="filters">
      <label>Servidor <select id="fServer"><option value="">Todos</option><option value="A">A</option><option value="B">B</option></select></label>
      <label>Lado <select id="fSide"><option value="">Todos</option><option value="SD">SD</option><option value="SV">SV</option></select></label>
      <label>Ganador <select id="fWinner"><option value="">Todos</option><option value="A">A</option><option value="B">B</option></select></label>
      <label>Final <select id="fEnd"><option value="">Todos</option><option value="Winner">Winner</option><option value="Error no forzado">Error no forzado</option><option value="Error forzado">Error forzado</option><option value="Doble falta">Doble falta</option></select></label>
      <label class="search">Buscar patrón <input id="fSearch" placeholder="Ej: A-CP - B-CP"></label>
    </div>

    <div class="historyGrid">
      <div class="historyCol historyListCol">
        <div class="historyList" id="historyList"></div>
      </div>
      <div class="historyCol historyDetailCol">
        <div class="historyDetail" id="historyDetail">Selecciona un punto.</div>
      </div>
    </div>
  </div>
</div>

<div class="modal hidden" id="analyticsModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Analíticas del partido</div>
        <div class="muted">Top patrones</div>
      </div>
      <button class="chip" id="btnCloseAnalytics" type="button">Cerrar</button>
    </div>

    <div class="filters">
      <label>Vista
        <select id="aView">
          <option value="freq">Más repetidos</option>
          <option value="effective">Más efectivos</option>
          <option value="deucead">DEUCE vs AD</option>
          <option value="server">Por servidor</option>
        </select>
      </label>
      <label>Mín. ocurrencias
        <select id="aMin">
          <option value="1">1</option>
          <option value="3">3</option>
          <option value="5" selected>5</option>
          <option value="8">8</option>
        </select>
      </label>
      <label class="check"><input type="checkbox" id="aIncludeServe" checked> Incluir saque</label>
    </div>

    <div class="analyticsBody">
      <div class="analyticsList" id="analyticsList"></div>
      <div class="analyticsDetail" id="analyticsDetail">Selecciona un patrón.</div>
    </div>
  </div>
</div>

<div class="modal hidden" id="exportModal">
  <div class="modalCard solid">
    <div class="modalHead">
      <div>
        <div class="modalTitle">Exportar</div>
        <div class="muted" id="exportSub">Puntos y patrones</div>
      </div>
      <button class="chip" id="btnCloseExport" type="button">Cerrar</button>
    </div>

    <div class="exportGrid">
      <button class="btn" id="btnCSV" type="button">Exportar CSV</button>
      <button class="btn" id="btnWord" type="button">Tabla Word (HTML)</button>
      <button class="btn primary" id="btnPDF" type="button">PDF premium (imprimir)</button>
    </div>
    <div class="muted">Tip: en PDF premium usa “Imprimir → Guardar como PDF”.</div>
  </div>
</div>

<div class="toast" id="toast"></div>

<!-- placeholders (compatibilidad) -->
<div id="serveActions" class="hidden"></div>
<div id="finishActions" class="hidden"></div>
<button id="btnFault" class="hidden" type="button"></button>
<button id="btnDoubleFault" class="hidden" type="button"></button>
<button id="btnUeA" class="hidden" type="button"></button>
<button id="btnUeB" class="hidden" type="button"></button>
<button id="btnFeA" class="hidden" type="button"></button>
<button id="btnFeB" class="hidden" type="button"></button>
<button id="btnWinA" class="hidden" type="button"></button>
<button id="btnWinB" class="hidden" type="button"></button>

<script src="app.js"></script>
</body>
</html>
